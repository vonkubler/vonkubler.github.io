<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Participant Distribution by Sector</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom animation for the bars */
        @keyframes grow {
            from {
                width: 0%;
            }
        }
        .animate-grow {
            animation: grow 0.8s ease-out forwards;
        }
        /* Styles for the modal */
        .modal {
            transition: opacity 0.25s ease;
        }
        .modal-content {
            transition: transform 0.25s ease;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4 sm:p-6 md:p-8">
    <div class="w-full max-w-4xl bg-white rounded-2xl shadow-lg p-6 sm:p-8 md:p-10">
        <!-- Header Section -->
        <div class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-800">Workforce Distribution Snapshot</h1>
            <p class="text-gray-500 mt-2 text-lg">Based on 66 survey participants</p>
        </div>

        <!-- Infographic Content -->
        <div class="space-y-6">
            <!-- Data will be injected here by JavaScript -->
            <div id="infographic-data"></div>
        </div>

        <!-- Footer Section -->
        <div class="text-center mt-10 border-t pt-6">
            <p class="text-sm text-gray-400">This infographic represents the distribution of participants across various employment sectors.</p>
        </div>
    </div>

    <!-- Modal for Career Insights -->
    <div id="insights-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-2xl p-6 relative transform scale-95">
            <button id="close-modal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
            <h2 class="text-2xl font-bold text-gray-800 mb-4" id="modal-title">Career Insights</h2>
            <div id="modal-body" class="text-gray-600 space-y-4 max-h-[70vh] overflow-y-auto">
                <!-- Loading spinner -->
                <div id="loader" class="flex justify-center items-center h-40">
                    <div class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-teal-500"></div>
                </div>
                <!-- API Response -->
                <div id="api-response" class="hidden"></div>
            </div>
        </div>
    </div>

    <script>
        // A single, complete data source for all sectors
        const allSectorsData = [
            { name: 'Hospitality / Food', participants: 8, percentage: 12.1, icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M21 15.5a2.5 2.5 0 01-5 0V7.33a2.5 2.5 0 015 0V15.5zm-5 0a2.5 2.5 0 005 0V7.33a2.5 2.5 0 00-5 0v8.17zM9 15.5a2.5 2.5 0 01-5 0V7.33a2.5 2.5 0 015 0v8.17zM4 15.5a2.5 2.5 0 005 0V7.33a2.5 2.5 0 00-5 0v8.17zM3 7.33V15.5a5.5 5.5 0 0011 0V7.33a5.5 5.5 0 00-11 0z" /><path stroke-linecap="round" stroke-linejoin="round" d="M18 7.33V15.5a5.5 5.5 0 0011 0V7.33a5.5 5.5 0 00-11 0z" transform="translate(-13)"/></svg>', color: 'bg-teal-500' },
            { name: 'Cleaning / Domestics', participants: 8, percentage: 12.1, icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l-3 3m5.5 5.5l-3 3M4 21V10a2 2 0 012-2h12a2 2 0 012 2v11" /></svg>', color: 'bg-teal-400' },
            { name: 'Retail, Sales & Customer Service', participants: 7, percentage: 10.6, icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" /></svg>', color: 'bg-cyan-500' },
            { name: 'Teaching & Education', participants: 5, percentage: 7.6, icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M12 14l9-5-9-5-9 5 9 5z" /><path d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-5.998 12.078 12.078 0 01.665-6.479L12 14z" /><path stroke-linecap="round" stroke-linejoin="round" d="M12 14l9-5-9-5-9 5 9 5zm0 0l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-5.998 12.078 12.078 0 01.665-6.479L12 14zm-4 6v-7.5l4-2.222 4 2.222V20" /></svg>', color: 'bg-sky-500' },
            { name: 'Government Services', participants: 4, percentage: 6.1, icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" /></svg>', color: 'bg-blue-500' },
            { name: 'Business & Finance', participants: 4, percentage: 6.1, icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>', color: 'bg-blue-400' },
            { name: 'Warehouse', participants: 3, percentage: 4.5, icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" /></svg>', color: 'bg-indigo-400' },
            { name: 'Social Care', participants: 3, percentage: 4.5, icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>', color: 'bg-indigo-400' },
            { name: 'Administrative / Clerical / HR', participants: 3, percentage: 4.5, icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" /></svg>', color: 'bg-indigo-400' },
            { name: 'Third Sector', participants: 2, percentage: 3.0, icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>', color: 'bg-purple-400' },
            { name: 'Writing, Journalism & Communication', participants: 2, percentage: 3.0, icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>', color: 'bg-purple-400' },
            { name: 'Healthcare', participants: 2, percentage: 3.0, icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /></svg>', color: 'bg-purple-400' },
            { name: 'Creative & Media', participants: 2, percentage: 3.0, icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z" /></svg>', color: 'bg-purple-400' },
            { name: 'Transport', participants: 2, percentage: 3.0, icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M9 17a2 2 0 11-4 0 2 2 0 014 0zM19 17a2 2 0 11-4 0 2 2 0 014 0z" /><path stroke-linecap="round" stroke-linejoin="round" d="M13 16V6a1 1 0 00-1-1H4a1 1 0 00-1 1v10l2 2h8a1 1 0 001-1z" /><path stroke-linecap="round" stroke-linejoin="round" d="M18 17h.01" /></svg>', color: 'bg-purple-400' },
            { name: 'Computing Technology & Digital', participants: 1, percentage: 1.5 },
            { name: 'Beauty & Wellbeing', participants: 1, percentage: 1.5 },
            { name: 'Environment & Land', participants: 1, percentage: 1.5 },
            { name: 'Taxi / Private Hire', participants: 1, percentage: 1.5 },
            { name: 'Childcare', participants: 1, percentage: 1.5 },
            { name: 'Construction & Trades', participants: 1, percentage: 1.5 },
        ];

        // Filter data into main sectors and "other" sectors to be grouped
        const mainSectors = allSectorsData.filter(s => s.participants > 1);
        const otherSectors = allSectorsData.filter(s => s.participants <= 1);

        // Aggregate the "other" sectors into a single object for display
        const otherParticipants = otherSectors.reduce((sum, s) => sum + s.participants, 0);
        const otherPercentage = otherSectors.reduce((sum, s) => sum + s.percentage, 0);

        const otherSectorData = {
            name: 'Various Other Sectors',
            participants: otherParticipants,
            percentage: otherPercentage.toFixed(1),
            icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" /></svg>',
            color: 'bg-slate-400',
            isOther: true,
            subSectors: otherSectors.map(s => s.name).join(', ')
        };

        // Combine the main sectors with the aggregated "other" group
        const displayData = [...mainSectors, otherSectorData];
        const container = document.getElementById('infographic-data');

        // Generate and inject the HTML for each data item
        displayData.forEach(sector => {
            // This is the corrected, more stable layout for each row
            const itemHTML = `
                <div class="flex items-center space-x-4 group">
                    <!-- Icon -->
                    <div class="flex-shrink-0 w-12 h-12 rounded-full ${sector.color || 'bg-gray-400'} text-white flex items-center justify-center transition-transform duration-300 group-hover:scale-110">
                        ${sector.icon || '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z" /></svg>'}
                    </div>
                    
                    <!-- Main Content: Name and Bar (This part is changed for stability) -->
                    <div class="flex-1 min-w-0">
                        <div class="flex justify-between items-baseline mb-1">
                            <p class="font-semibold text-gray-700 truncate pr-2">${sector.name}</p>
                            <p class="text-sm font-bold flex-shrink-0 ${sector.color ? sector.color.replace('bg-', 'text-') : 'text-gray-400'}">${sector.percentage}%</p>
                        </div>
                        <div class="bg-gray-200 rounded-full h-5 overflow-hidden">
                             <div class="animate-grow ${sector.color || 'bg-gray-400'} h-full rounded-full flex items-center justify-end pr-3" style="width: ${sector.percentage}%">
                                 <span class="text-xs font-bold text-white">${sector.participants}</span>
                             </div>
                        </div>
                    </div>

                    <!-- Button -->
                    <div class="flex-shrink-0">
                        <button class="get-insights-btn bg-gray-200 hover:bg-teal-500 hover:text-white text-gray-600 font-bold py-2 px-3 rounded-lg transition-colors duration-300 text-sm" data-sector="${sector.name}" data-sub-sectors="${sector.subSectors || ''}">
                            âœ¨ Insights
                        </button>
                    </div>
                </div>
            `;
            container.innerHTML += itemHTML;
        });

        // Modal Handling
        const modal = document.getElementById('insights-modal');
        const closeModalBtn = document.getElementById('close-modal');
        const modalTitle = document.getElementById('modal-title');
        const loader = document.getElementById('loader');
        const apiResponseEl = document.getElementById('api-response');

        function showModal() {
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.add('opacity-100');
                modal.querySelector('.modal-content').classList.remove('scale-95');
            }, 10);
        }

        function hideModal() {
            modal.classList.remove('opacity-100');
            modal.querySelector('.modal-content').classList.add('scale-95');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 250);
        }

        closeModalBtn.addEventListener('click', hideModal);
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                hideModal();
            }
        });

        // Gemini API call
        async function getCareerInsights(sectorName, subSectors) {
            modalTitle.textContent = `Career Insights: ${sectorName}`;
            apiResponseEl.classList.add('hidden');
            loader.classList.remove('hidden');
            showModal();

            let prompt;
            if (subSectors) {
                prompt = `For the following collection of sectors: ${subSectors}, provide a general overview of the types of roles available. Then, briefly describe common required skills and the general career outlook. Keep the tone encouraging and informative. Format the response using HTML paragraphs.`;
            } else {
                prompt = `Provide a brief, encouraging, and informative overview of career paths, key skills, and the future outlook for the '${sectorName}' sector. Structure the response with clear HTML H3 headings for "Career Paths", "Key Skills", and "Future Outlook", and use HTML paragraphs for the text.`;
            }
            
            // --- IMPORTANT ---
            // The API key is missing when you run this on GitHub.
            // 1. Get your free API key from Google AI Studio.
            // 2. Paste it here to make the buttons work on your live site.
            const apiKey = "AIzaSyDeVkSsGRVLU3BmSmA_rUqv6drN1u-V0Vs"; 
            
            if (apiKey === "AIzaSyDeVkSsGRVLU3BmSmA_rUqv6drN1u-V0Vs" || !apiKey) {
                 apiResponseEl.innerHTML = `<p class="text-red-500">API Key is missing. Please follow the instructions to add your API key to the code.</p>`;
                 loader.classList.add('hidden');
                 apiResponseEl.classList.remove('hidden');
                 return;
            }

            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            try {
                const payload = { contents: [{ parts: [{ text: prompt }] }] };
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API request failed with status ${response.status}`);
                }

                const result = await response.json();
                
                if (result.candidates && result.candidates.length > 0 && result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    apiResponseEl.innerHTML = text;
                } else {
                     throw new Error("No content received from API.");
                }

            } catch (error) {
                console.error("Error fetching career insights:", error);
                apiResponseEl.innerHTML = `<p class="text-red-500">Sorry, we couldn't fetch the insights at the moment. Please try again later.</p>`;
            } finally {
                loader.classList.add('hidden');
                apiResponseEl.classList.remove('hidden');
            }
        }

        container.addEventListener('click', (e) => {
            const button = e.target.closest('.get-insights-btn');
            if (button) {
                const sectorName = button.dataset.sector;
                const subSectors = button.dataset.subSectors;
                getCareerInsights(sectorName, subSectors);
            }
        });

    </script>
</body>
</html>
