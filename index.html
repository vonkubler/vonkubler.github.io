<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Digital Sanctuary | Mindful Photography</title>
    <!-- Chosen Palette: Earthy & Grounded -->
    <!-- Application Structure Plan: A single-page application with distinct scrollable sections (Home, Gallery, The Practice, About) and a full-screen interactive modal for viewing images. This structure directly translates the report's blueprint into a navigable, unhurried user flow, prioritizing exploration over linear progression. The core interaction is centered on the dual-mode (Mindful/Contemplative) image viewer, which is the central unique feature proposed in the source document. A Gemini API integration adds AI-generated poetic reflections to deepen the contemplative experience. -->
    <!-- Visualization & Content Choices: 
        - Report Info: Gallery -> Goal: Explore/Organize -> Viz/Method: Masonry-style grid (HTML/Tailwind) -> Interaction: Hover zoom, click to open modal -> Justification: Creates a dynamic, organic feel that encourages discovery, as recommended.
        - Report Info: Dual Viewing Experience -> Goal: Engage/Contemplate -> Viz/Method: Full-screen modal with toggleable sidebar (HTML/JS) -> Interaction: Button to switch between "Mindful" (image only) and "Contemplative" (image + text) modes -> Justification: Directly implements the core philosophical feature of the report, separating pure perception from narrative context.
        - Report Info: Guided Gaze UI -> Goal: Educate/Guide -> Viz/Method: Timed text overlays on image (JS setTimeout) -> Interaction: User initiates a sequence of prompts -> Justification: Transforms the site from a portfolio into an interactive teaching tool, as envisioned in the report.
        - Report Info: AI-Powered Reflection -> Goal: Deepen Engagement -> Viz/Method: Button triggers Gemini API call (JS Fetch) -> Interaction: User clicks to generate a unique poem based on photo's context -> Justification: Adds a dynamic, generative layer to the contemplative practice, making each viewing a unique experience. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Source+Sans+Pro:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #FEFBE3; /* Cream */
            color: #4E4D49; /* Dark Grey */
            font-family: 'Source Sans Pro', sans-serif;
        }
        h1, h2, h3 {
            font-family: 'Playfair Display', serif;
        }
        .font-heading { font-family: 'Playfair Display', serif; }
        .font-body { font-family: 'Source Sans Pro', sans-serif; }
        .bg-cream { background-color: #FEFBE3; }
        .bg-champagne { background-color: #D6CFBF; }
        .text-dark-grey { color: #4E4D49; }
        .text-muted-gold { color: #B7946A; }
        .border-muted-gold { border-color: #B7946A; }
        .accent-muted-gold { background-color: #B7946A; }
        .masonry-grid {
            column-count: 1;
            column-gap: 1.5rem;
        }
        @media (min-width: 640px) { .masonry-grid { column-count: 2; } }
        @media (min-width: 1024px) { .masonry-grid { column-count: 3; } }
        .masonry-item {
            break-inside: avoid;
            margin-bottom: 1.5rem;
        }
        .transition-all-slow { transition: all 0.5s ease-in-out; }
        .modal-overlay {
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease-in-out, visibility 0s 0.5s;
        }
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
            transition: opacity 0.5s ease-in-out;
        }
        .modal-content {
            transform: scale(0.95);
            opacity: 0;
            transition: all 0.5s ease-in-out;
        }
        .modal-overlay.active .modal-content {
            transform: scale(1);
            opacity: 1;
        }
        .contemplative-sidebar {
            transform: translateX(100%);
            transition: transform 0.5s ease-in-out;
        }
        .contemplative-sidebar.active {
            transform: translateX(0);
        }
        .guided-gaze-prompt {
            opacity: 0;
            transition: opacity 1.5s ease-in-out;
        }
        .guided-gaze-prompt.active {
            opacity: 1;
        }
        .spinner {
            border: 2px solid #D6CFBF;
            border-top: 2px solid #B7946A;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-cream text-dark-grey font-body antialiased">

    <header id="header" class="fixed top-0 left-0 right-0 z-40 bg-cream/80 backdrop-blur-sm transition-all-slow">
        <div class="container mx-auto px-6 py-4">
            <nav class="flex justify-between items-center">
                <a href="#home" class="font-heading text-2xl font-bold tracking-wider">The Digital Sanctuary</a>
                <div class="hidden md:flex items-center space-x-8 text-lg">
                    <a href="#gallery" class="hover:text-muted-gold transition-colors duration-300">Gallery</a>
                    <a href="#practice" class="hover:text-muted-gold transition-colors duration-300">The Practice</a>
                    <a href="#about" class="hover:text-muted-gold transition-colors duration-300">About</a>
                </div>
                <button id="mobile-menu-button" class="md:hidden text-2xl">â˜°</button>
            </nav>
        </div>
        <div id="mobile-menu" class="hidden md:hidden bg-cream text-center py-4">
             <a href="#gallery" class="block py-2 text-lg hover:text-muted-gold">Gallery</a>
             <a href="#practice" class="block py-2 text-lg hover:text-muted-gold">The Practice</a>
             <a href="#about" class="block py-2 text-lg hover:text-muted-gold">About</a>
        </div>
    </header>

    <main>
        <section id="home" class="h-screen w-full flex items-center justify-center bg-cover bg-center" style="background-image: url('https://placehold.co/1920x1080/4E4D49/FEFBE3?text=Observe+the+Unseen');">
            <div class="text-center text-cream bg-black/30 p-8 rounded-lg">
                <h1 class="font-heading text-5xl md:text-7xl font-bold">Find Stillness in Seeing</h1>
                <p class="font-body text-xl md:text-2xl mt-4 max-w-2xl">An exploration of mindful photography, where the camera becomes a tool for presence.</p>
            </div>
        </section>

        <section id="gallery" class="py-20 md:py-32">
            <div class="container mx-auto px-6">
                <div class="text-center max-w-3xl mx-auto mb-16">
                    <h2 class="font-heading text-4xl md:text-5xl font-bold">The Gallery</h2>
                    <p class="text-lg mt-4">This is the heart of the website, a collection of moments captured through a lens of mindfulness. Each image is an invitation to pause, observe, and connect with the present. Hover to feel a connection, click to immerse yourself in the view. The experience is designed to be unhurried, allowing for personal discovery and resonance.</p>
                </div>
                <div id="masonry-container" class="masonry-grid">
                </div>
            </div>
        </section>

        <section id="practice" class="py-20 md:py-32 bg-champagne/50">
            <div class="container mx-auto px-6">
                <div class="max-w-3xl mx-auto">
                    <div class="text-center mb-16">
                        <h2 class="font-heading text-4xl md:text-5xl font-bold">The Practice of Seeing</h2>
                        <p class="text-lg mt-4">Mindful photography is not about taking the perfect picture. It is about the process of seeing itself. This section is dedicated to explaining the philosophy and techniques that transform photography from a technical craft into a contemplative practice. It's an invitation to slow down and cultivate a richer awareness of the world around you.</p>
                    </div>
                    <div class="space-y-12 text-lg leading-relaxed">
                        <div>
                            <h3 class="font-heading text-3xl mb-4">Slowing Down</h3>
                            <p>In a world that rushes, mindful photography is an act of rebellion. It begins with the conscious decision to slow down. We put the camera away and simply walk, allowing our senses to guide us. We notice the quality of light, the texture of a leaf, the rhythm of shadows. The goal is not to hunt for photos, but to allow photos to find us. This patience cultivates a deep presence, making the act of photography a meditative experience rather than a task to be completed.</p>
                        </div>
                        <div>
                            <h3 class="font-heading text-3xl mb-4">Sensory Focus</h3>
                            <p>While photography is a visual medium, the mindful practice engages all senses. We feel the cool breeze, hear the distant city hum, smell the damp earth after rain. This full-body awareness enriches our perception, allowing us to capture not just what a scene looks like, but what it *feels* like. The camera becomes a tool to translate these multi-sensory experiences into a two-dimensional frame, imbuing the final image with a palpable sense of atmosphere and emotion.</p>
                        </div>
                        <div>
                            <h3 class="font-heading text-3xl mb-4">Embracing Imperfection</h3>
                            <p>The Japanese concept of Wabi-Sabi finds beauty in imperfection and transience. Mindful photography embraces this philosophy. We let go of the need for technical perfection and instead celebrate authenticity. Lens flares, soft focus, unexpected shadows, and fleeting moments are not mistakes; they are evidence of a real, unposed experience. This acceptance frees us from creative pressure and opens our eyes to the profound beauty hidden in the ordinary and the imperfect.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="about" class="py-20 md:py-32">
            <div class="container mx-auto px-6">
                 <div class="text-center max-w-3xl mx-auto mb-16">
                    <h2 class="font-heading text-4xl md:text-5xl font-bold">Artist's Story</h2>
                    <p class="text-lg mt-4">Every artist has a "why"â€”the driving force behind their work. This page shares the personal journey that led to the creation of The Digital Sanctuary. It's a story about finding a path from the noise of the everyday to the quiet of mindful observation, and how the camera became an unexpected guide in that process. Authenticity and connection are at the heart of this practice.</p>
                </div>
                <div class="flex flex-col lg:flex-row items-center gap-12 lg:gap-16">
                    <div class="w-full lg:w-1/3">
                        <img src="https://placehold.co/600x800/D6CFBF/4E4D49?text=Artist" alt="A portrait of the artist" class="rounded-lg shadow-xl w-full h-auto object-cover">
                    </div>
                    <div class="w-full lg:w-2/3 text-lg leading-relaxed space-y-6">
                        <p>My journey with photography didn't start in a studio or a classroom. It started on long, aimless walks through my city, feeling overwhelmed by the pace of modern life. I carried a camera not with the intention of creating art, but as a shieldâ€”a reason to be an observer rather than a participant. It gave me permission to be quiet, to stand still, to simply watch.</p>
                        <p>Over time, I realized the camera was more than a shield; it was a lens, and not just in the optical sense. It was focusing my attention. I started noticing things I'd walked past a thousand times: the way light painted ephemeral patterns on a brick wall, the intricate geometry of a forgotten weed growing through a crack in the pavement, the quiet dignity of an old bench.</p>
                        <p>This was my unintentional discovery of mindfulness. The act of looking for a photograph became a practice in being present. This website is the culmination of that journey. It's not just a portfolio of my work; it's an invitation to join me in this practice of seeing. It's a testament to the idea that peace and beauty are not in some distant, exotic location, but are waiting to be discovered right here, right now, in the quiet details of our own lives.</p>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <footer class="bg-champagne/50 py-8">
        <div class="container mx-auto px-6 text-center text-dark-grey">
            <p>&copy; 2025 The Digital Sanctuary. All rights reserved.</p>
            <p class="text-sm mt-2">A space for mindful observation.</p>
        </div>
    </footer>

    <div id="modal" class="modal-overlay fixed inset-0 bg-cream/95 z-50 flex items-center justify-center p-4">
        <div class="modal-content relative w-full h-full flex items-center justify-center">
            <button id="modal-close" class="absolute top-4 right-4 text-dark-grey text-4xl font-thin z-50 hover:text-muted-gold transition-colors">&times;</button>
            
            <button id="modal-prev" class="absolute left-4 md:left-8 top-1/2 -translate-y-1/2 text-dark-grey text-4xl z-50 hover:text-muted-gold transition-colors">â€¹</button>
            <button id="modal-next" class="absolute right-4 md:right-8 top-1/2 -translate-y-1/2 text-dark-grey text-4xl z-50 hover:text-muted-gold transition-colors">â€º</button>

            <div class="w-full h-full flex items-center justify-center overflow-hidden">
                 <img id="modal-image" src="" alt="Mindful photograph" class="max-w-full max-h-full object-contain transition-all-slow">
                 <div id="guided-gaze-container" class="absolute inset-0 flex items-center justify-center p-8 pointer-events-none"></div>
            </div>

            <div id="contemplative-sidebar" class="contemplative-sidebar absolute top-0 right-0 h-full w-full md:w-1/3 max-w-md bg-cream shadow-2xl p-8 overflow-y-auto">
                <h3 id="contemplative-title" class="font-heading text-3xl mb-4"></h3>
                <div id="contemplative-text" class="text-lg leading-relaxed space-y-4"></div>
                <button id="guided-gaze-button" class="mt-8 w-full accent-muted-gold text-cream py-3 rounded-lg font-bold hover:opacity-90 transition-opacity">Begin Guided Gaze</button>
                <button id="poetic-reflection-button" class="mt-4 w-full border-2 border-muted-gold text-muted-gold py-3 rounded-lg font-bold hover:bg-muted-gold hover:text-cream transition-colors flex items-center justify-center gap-2">
                    âœ¨ Generate Poetic Reflection
                </button>
                <div id="poetic-reflection-container" class="mt-6 p-4 border border-champagne rounded-lg min-h-[100px] whitespace-pre-wrap font-body text-dark-grey"></div>
            </div>

            <button id="contemplative-toggle" class="absolute bottom-4 right-4 w-12 h-12 bg-dark-grey/80 text-cream rounded-full flex items-center justify-center text-2xl font-heading hover:bg-dark-grey transition-colors" title="Toggle Contemplative Mode">C</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const imageData = [
                {
                    id: 0,
                    src: 'https://placehold.co/800x1200/D6CFBF/4E4D49?text=Texture',
                    title: 'Worn by Time',
                    text: '<p>This is the texture of an old wooden pier. I was drawn to the deep grooves and the way the soft morning light caught the splinters. It felt like a map of countless seasons, each tide and storm leaving its mark. Itâ€™s a reminder that there is a profound story in surfaces, if we only take a moment to read them.</p>',
                    gazePrompts: [
                        "Take a slow breath. Let your eyes soften and rest on the image.",
                        "Notice the quality of the light. Where is it brightest? Where are the deepest shadows?",
                        "Follow the long, vertical lines with your eyes. Sense their history and strength.",
                        "What feeling does the rough texture evoke in you? Can you imagine running your hand over it?",
                        "Now, allow your eyes to wander freely across the entire image."
                    ]
                },
                {
                    id: 1,
                    src: 'https://placehold.co/1200x800/4E4D49/FEFBE3?text=Light',
                    title: 'Corridor of Light',
                    text: '<p>I found this underpass on a walk. Most people hurry through, but I was struck by the perfect rectangle of light at the end. It felt like a portal. The darkness wasnâ€™t menacing; it was quiet and still, framing the brilliant light. It speaks to the idea that even in dark places, there is always a path toward brightness.</p>',
                     gazePrompts: [
                        "Begin with a gentle breath. Settle into this moment of seeing.",
                        "Let your gaze rest on the bright rectangle at the end. Feel its pull.",
                        "Now, explore the darkness. Notice the subtle shifts in tone on the walls.",
                        "Sense the stillness in this empty space. What does silence look like?",
                        "Now, see the image as a whole, a balance of dark and light."
                    ]
                },
                {
                    id: 2,
                    src: 'https://placehold.co/800x800/B7946A/FEFBE3?text=Form',
                    title: 'Humble Geometry',
                    text: '<p>A simple leaf, fallen on wet pavement. I almost missed it. But its elegant curves and the perfect symmetry of its veins stopped me. It was a small, perfect piece of natural architecture. This photo is a celebration of the extraordinary design that exists in the most ordinary of things.</p>',
                     gazePrompts: [
                        "Take a breath in, and a breath out. Be present with this image.",
                        "Trace the central vein of the leaf, from the stem to the tip.",
                        "Notice the delicate network of smaller veins. See the pattern they create.",
                        "Observe the contrast between the soft leaf and the hard pavement.",
                        "What emotion does this simple, solitary form convey to you?",
                        "Let your eyes soften and take in the entire composition."
                    ]
                },
                 {
                    id: 3,
                    src: 'https://placehold.co/800x1200/2C3E50/ECF0F1?text=Reflection',
                    title: 'Sky Below',
                    text: '<p>After a rainstorm, the world doubles itself. This puddle wasn\'t just water on asphalt; it was a temporary window holding a piece of the sky. The reflection was so clear, it felt like you could fall right in. Itâ€™s a lesson in perspectiveâ€”sometimes, to see the heavens, you have to look down.</p>',
                    gazePrompts: [
                        "Breathe in calm, breathe out noise. Focus your attention here.",
                        "Look at the color of the reflected sky. Is it different from the real sky you imagine?",
                        "Notice the edges of the puddle, where the illusion meets reality.",
                        "Can you spot any imperfections in the reflection? What do they add?",
                        "Feel the sense of depth in the image, as if looking into another world.",
                        "Now, appreciate the entire scene in its fleeting beauty."
                    ]
                },
                {
                    id: 4,
                    src: 'https://placehold.co/1200x800/ECF0F1/2C3E50?text=Shadow',
                    title: 'Afternoon Lines',
                    text: '<p>The late afternoon sun casts the longest shadows. I became fascinated by the way the shadow of a simple fence transformed the blank wall into a piece of graphic art. The shadow was more present, more defined, than the object casting it. It taught me that sometimes, the absence of light is what creates the most compelling subject.</p>',
                    gazePrompts: [
                        "Center yourself with a slow, deep breath.",
                        "Follow one of the dark, diagonal lines from top to bottom.",
                        "Observe the space between the lines. How does the light feel there?",
                        "Notice the sharp edges of the shadows. What does that sharpness communicate?",
                        "Imagine the sun that is creating this pattern. Where would it be?",
                        "Take in the entire rhythm of light and shadow."
                    ]
                },
                {
                    id: 5,
                    src: 'https://placehold.co/800x800/D6CFBF/4E4D49?text=Detail',
                    title: 'Dew Drop',
                    text: '<p>A single drop of dew on a blade of grass, holding a tiny, refracted world within it. To see this required me to get low, to get close, to forget everything else. Itâ€™s a universe in miniature. This image is about the power of focus, and the immense beauty that reveals itself when we narrow our attention to a single, tiny detail.</p>',
                    gazePrompts: [
                        "Let go of your day. Be here with this image.",
                        "Focus on the single drop of water. See how it bends the light.",
                        "Can you see the tiny world reflected inside it?",
                        "Notice the texture of the blade of grass it rests upon.",
                        "Feel the fragility and preciousness of this tiny moment.",
                        "Zoom out with your eyes to see the drop in its context."
                    ]
                }
            ];

            const masonryContainer = document.getElementById('masonry-container');
            const modal = document.getElementById('modal');
            const modalImage = document.getElementById('modal-image');
            const modalClose = document.getElementById('modal-close');
            const modalPrev = document.getElementById('modal-prev');
            const modalNext = document.getElementById('modal-next');
            const contemplativeToggle = document.getElementById('contemplative-toggle');
            const contemplativeSidebar = document.getElementById('contemplative-sidebar');
            const contemplativeTitle = document.getElementById('contemplative-title');
            const contemplativeText = document.getElementById('contemplative-text');
            const guidedGazeButton = document.getElementById('guided-gaze-button');
            const guidedGazeContainer = document.getElementById('guided-gaze-container');
            const poeticReflectionButton = document.getElementById('poetic-reflection-button');
            const poeticReflectionContainer = document.getElementById('poetic-reflection-container');
            
            let currentImageIndex = 0;
            let gazeTimeout;
            let isGeneratingPoem = false;

            function populateGallery() {
                imageData.forEach(img => {
                    const item = document.createElement('div');
                    item.className = 'masonry-item group cursor-pointer';
                    item.innerHTML = `
                        <div class="relative overflow-hidden rounded-lg shadow-lg">
                            <img src="${img.src}" alt="${img.title}" data-index="${img.id}" class="w-full h-auto block transform transition-all-slow group-hover:scale-105">
                            <div class="absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                        </div>
                    `;
                    masonryContainer.appendChild(item);
                });
            }

            function openModal(index) {
                currentImageIndex = parseInt(index);
                const img = imageData[currentImageIndex];
                
                modalImage.src = img.src;
                contemplativeTitle.textContent = img.title;
                contemplativeText.innerHTML = img.text;
                poeticReflectionContainer.innerHTML = '';

                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
                
                resetContemplativeState();
            }
            
            function closeModal() {
                modal.classList.remove('active');
                document.body.style.overflow = '';
                resetContemplativeState();
            }
            
            function resetContemplativeState() {
                contemplativeSidebar.classList.remove('active');
                clearTimeout(gazeTimeout);
                guidedGazeContainer.innerHTML = '';
                modalImage.style.filter = 'none';
                poeticReflectionContainer.innerHTML = '';
                isGeneratingPoem = false;
            }

            function showNextImage() {
                currentImageIndex = (currentImageIndex + 1) % imageData.length;
                openModal(currentImageIndex);
            }

            function showPrevImage() {
                currentImageIndex = (currentImageIndex - 1 + imageData.length) % imageData.length;
                openModal(currentImageIndex);
            }
            
            function startGuidedGaze() {
                const prompts = imageData[currentImageIndex].gazePrompts;
                if (!prompts || prompts.length === 0) return;

                clearTimeout(gazeTimeout);
                guidedGazeContainer.innerHTML = '';
                modalImage.style.filter = 'brightness(0.7)';

                let i = 0;
                function showNextPrompt() {
                    if (i < prompts.length) {
                        const promptEl = document.createElement('div');
                        promptEl.className = 'guided-gaze-prompt text-cream text-2xl md:text-3xl text-center font-heading bg-black/50 p-4 rounded-lg';
                        promptEl.textContent = prompts[i];
                        guidedGazeContainer.innerHTML = '';
                        guidedGazeContainer.appendChild(promptEl);
                        
                        setTimeout(() => promptEl.classList.add('active'), 100);

                        i++;
                        gazeTimeout = setTimeout(showNextPrompt, 4500);
                    } else {
                        guidedGazeContainer.innerHTML = '';
                        modalImage.style.filter = 'none';
                    }
                }
                showNextPrompt();
            }

            async function generatePoeticReflection() {
                if (isGeneratingPoem) return;
                isGeneratingPoem = true;
                
                poeticReflectionContainer.innerHTML = '<div class="flex justify-center items-center h-full"><div class="spinner"></div></div>';
                
                const currentImage = imageData[currentImageIndex];
                const cleanText = currentImage.text.replace(/<p>|<\/p>/g, '');
                const prompt = `Based on the following title and description of a photograph, write a short, reflective, and hopeful poem of 4-6 lines. Do not use the title in the poem itself.
                
                Title: "${currentImage.title}"
                Description: "${cleanText}"
                
                Poem:`;

                try {
                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                    const payload = { contents: chatHistory };
                    const apiKey = ""; 
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                    
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`API request failed with status ${response.status}`);
                    }

                    const result = await response.json();
                    
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const poemText = result.candidates[0].content.parts[0].text;
                        poeticReflectionContainer.textContent = poemText;
                    } else {
                         throw new Error('Unexpected API response structure.');
                    }

                } catch (error) {
                    console.error("Error generating poem:", error);
                    poeticReflectionContainer.textContent = 'Could not generate a reflection at this time. Please try again later.';
                } finally {
                    isGeneratingPoem = false;
                }
            }


            masonryContainer.addEventListener('click', (e) => {
                if (e.target.dataset.index) {
                    openModal(e.target.dataset.index);
                }
            });

            modalClose.addEventListener('click', closeModal);
            modalPrev.addEventListener('click', showPrevImage);
            modalNext.addEventListener('click', showNextImage);
            
            contemplativeToggle.addEventListener('click', () => {
                contemplativeSidebar.classList.toggle('active');
            });

            guidedGazeButton.addEventListener('click', startGuidedGaze);
            poeticReflectionButton.addEventListener('click', generatePoeticReflection);

            document.addEventListener('keydown', (e) => {
                if (modal.classList.contains('active')) {
                    if (e.key === 'Escape') closeModal();
                    if (e.key === 'ArrowRight') showNextImage();
                    if (e.key === 'ArrowLeft') showPrevImage();
                }
            });
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeModal();
                }
            });

            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });

            document.querySelectorAll('#mobile-menu a').forEach(link => {
                link.addEventListener('click', () => {
                    mobileMenu.classList.add('hidden');
                });
            });
            
            let lastScrollY = window.scrollY;
            const header = document.getElementById('header');
            window.addEventListener('scroll', () => {
                if (window.scrollY > 100) {
                    header.classList.add('shadow-md');
                } else {
                    header.classList.remove('shadow-md');
                }
                lastScrollY = window.scrollY;
            });

            populateGallery();
        });
    </script>
</body>
</html>
